# Тестовое задание для ООО "Интеграти"
Оригинальный файл с тестовым заданием находится [здесь](https://docs.google.com/document/d/1KeLGq6_l9dPBSEpKcAQO16iPxO0G9G-Cy1CJ41QUsS8/). Задание выполнено на учебной конфигурации, уже содержащей некоторые из необходимых объектов.
## Задача 1
### Условие задачи
> Есть регистр `Продажи`. Измерение - `Клиент`, `Товар`. Ресурсы - `Количество`.
> 
> _Запросом получить всех клиентов, кто купил `товар А`, но не купил `товар B`_
> 
> ООО Ромашка  / Товар А
> ООО Ромашка  / Товар B
> ИП Иванов  / Товар B
> 
> Спр `Номенклатура`:
>  **Шкаф**, 
> **Стол**,
> **Стул**
> 
> Регистр `Продажи` - `Номенклатура` / `Количество`/`Сумма`
> 
> `Продажи`:
> Шкаф - 2 штуки
> Стул - 1 штука. 
> 
> Где Продажи.Количество is null
> 
> | Номенклатура.Ссылка | Продажи.Количество |
> | ------|--------|
> | Шкаф | 2 |
> | **Стол** | NULL |
> | **Стул** |  1 |
### Решение
#### Исходные данные: регистр оборотов "Продажи"
![KM3ZLKDqGn](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/1389cc9f-cfa4-48d3-b69c-092927dbe6a7)
#### Результаты тестирования
![2023-11-20_15-58](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/1cfc92f4-658d-4584-a530-c810c0a2e7fd)
#### Текст и параметры запроса
```
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ПродажиОбороты.Контрагент КАК Клиент,
	ПродажиОбороты.Номенклатура КАК Товар,
	ПродажиОбороты.КоличествоОборот КАК Продано
ПОМЕСТИТЬ ВТ_ПродажиТовараА
ИЗ
	РегистрНакопления.Продажи.Обороты(, , , Номенклатура = &ТоварА) КАК ПродажиОбороты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ПродажиОбороты.Контрагент КАК Клиент,
	ПродажиОбороты.Номенклатура КАК Товар,
	ПродажиОбороты.КоличествоОборот КАК Продано
ПОМЕСТИТЬ ВТ_ПродажиТовараВ
ИЗ
	РегистрНакопления.Продажи.Обороты(, , , Номенклатура = &ТоварВ) КАК ПродажиОбороты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_ПродажиТовараА.Клиент КАК Клиент
ИЗ
	ВТ_ПродажиТовараА КАК ВТ_ПродажиТовараА
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПродажиТовараВ КАК ВТ_ПродажиТовараВ
		ПО ВТ_ПродажиТовараА.Клиент = ВТ_ПродажиТовараВ.Клиент
ГДЕ
	ВТ_ПродажиТовараВ.Клиент ЕСТЬ NULL
```
![2023-11-20_15-51](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/9465b44f-78d8-4aef-a021-3c5a0c53d627)
![2023-11-20_15-52](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/5c600b5d-7220-4c63-a399-697e44d219d5)

## Задача 2
### Условие задачи
> Есть таблица значений с полями `Контрагент` и `Сумма`. Напишите процедуру, которая удалит из таблицы все строки, с `суммой` меньше 100 рублей
### Решение
#### Исходные данные: таблица значений на форме в обработке
![2023-11-20_17-22](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/b1baa350-5345-495c-981f-acb43c8f0602)
#### Результаты тестирования
![2023-11-21_14-50](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/a4e7cdca-bdc2-4475-bf88-74dca1fd86b8)
#### Код процедуры
```
&НаКлиенте
Процедура УдалитьЧастьЯччеек(Команда)
	УдалитьЧастьЯччеекНаСервере();
КонецПроцедуры

&НаСервере
Процедура УдалитьЧастьЯччеекНаСервере()
	
	ТаблицаОбъект = РеквизитФормыВЗначение("ТаблицаЗначений");
	
	УдалитьСтрокиТаблицыЗначений(ТаблицаОбъект);
	
	ЗначениеВРеквизитФормы(ТаблицаОбъект, "ТаблицаЗначений");
	
КонецПроцедуры

&НаСервереБезКонтекста
Процедура УдалитьСтрокиТаблицыЗначений(ТаблицаЗначений)
	
	МассивКУдалению = Новый Массив;
	
	Для каждого СтрокаТЗ Из ТаблицаЗначений Цикл
		Если СтрокаТЗ.Сумма < 100 Тогда
			
			МассивКУдалению.Добавить(СтрокаТЗ);
			
		КонецЕсли;
	КонецЦикла;
			
	Для каждого ЭлементКУдалению Из МассивКУдалению Цикл
		ТаблицаЗначений.Удалить(ЭлементКУдалению);
	КонецЦикла;
	
КонецПроцедуры
```
## Задача 3
### Условие задачи
> В конфигурации есть регистр сведений `Производственный календарь`. Измерение - `Дата`, ресурс - `Рабочий день(булево)`, `Истина` - если день рабочий, иначе - `Ложь`.
> 
> Реализовать функцию, которая прибавляет `X` рабочих Дней к исходной дате.
### Решение
#### Исходные данные: непереодический регистр сведений `ПроизводственныйКалендарь`
![2023-11-20_17-25](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/d7e2aa40-86da-4bc0-bbb3-3a0675376166)

#### Результаты тестирования
![2023-11-21_09-47](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/4c2609bf-0ff9-4957-bd76-60d1e0e276f3)
![2023-11-21_09-47_1](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/88e5f908-f622-4ef3-8d68-5e6b96c7a544)
![2023-11-21_09-45](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/6a804876-77dc-405b-b00c-97072f49c3cb)
![2023-11-21_09-44](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/674aac8f-5f76-4832-bae6-a84aa9ae3491)
#### Код функции
```
&НаСервереБезКонтекста
Функция ПолучитьНовуюДатуНаСервере(ИсходнаяДата, КоличествоДней)
	
	// Проверить, есть ли запись с исходной датой в регистре сведений "ПроизводственныйКалендарь"
	Запрос = Новый Запрос;
	Запрос.Текст =  "ВЫБРАТЬ
	                |	ПроизводственныйКалендарь.Дата КАК Дата
	                |ИЗ
	                |	РегистрСведений.ПроизводственныйКалендарь КАК ПроизводственныйКалендарь
	                |ГДЕ
	                |	ПроизводственныйКалендарь.Дата = &Дата";
					
    Запрос.УстановитьПараметр("Дата", ИсходнаяДата);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	// Если запись с исходной датой не найдена, то сообщить об этом пользователю
	Если РезультатЗапроса.Пустой() Тогда
	
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Производственный календарь не содержит запись с датой " + 
			Формат(ИсходнаяДата, "ДФ=dd.MM.yyyy; ДП='Пустая дата'");
		Сообщение.Сообщить();
		
		Возврат Неопределено;
	
	КонецЕсли;
	
	// Получить одним запросом требуемую дату с прибавкой дней
	Запрос.Текст =
		// Выбрать первые "КоличествоДней" дней календаря, так чтобы получились только те даты, которые > ИсходнаяДата и рабочие
		"ВЫБРАТЬ ПЕРВЫЕ " + Число(КоличествоДней) + "
		|	Календарь.Дата КАК Дата
		|ПОМЕСТИТЬ ВТ_РабочиеДни
		|ИЗ
		|	РегистрСведений.ПроизводственныйКалендарь КАК Календарь
		|ГДЕ
		|	Дата > &ИсходнаяДата
		|	И Календарь.РабочийДень = ИСТИНА
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		// Т.к. даты были выбраны из календаря строго по возрастанию, то чтобы получить смещенную дату, нужно выбрать максимальную дату
		|ВЫБРАТЬ
		|	МАКСИМУМ(ВТ_РабочиеДни.Дата) КАК Дата
		|ИЗ
		|	ВТ_РабочиеДни КАК ВТ_РабочиеДни
		|
		// Чтобы исключить ситуацию, когда ИсходнаяДата есть в Календаре, но Смещенная дата отсутствует в нем
		// (при этом образуется ситуация, что Количество выбранных рабочих дней меньше "КоличествоДней") 
		// использовано условие равенства количества дней в ВТ_РабочиеДни и заданного КоличествоДней
		|ИМЕЮЩИЕ
		|	Количество(ВТ_РабочиеДни.Дата) = &КоличествоДней";
	
	Запрос.УстановитьПараметр("ИсходнаяДата", ИсходнаяДата);
	Запрос.УстановитьПараметр("КоличествоДней", КоличествоДней);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	// Проверить выборку на пустоту, если пустая - это значит возникла ситуация, когда Исходная дата есть в календаре, 
	// а конечная дата (смещенная на "КоличествоДней") не содержится в нем. Сообщить об обработанной ситуации пользователю.
	Если РезультатЗапроса.Пустой() Тогда
	
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = СтрШаблон("Производственный календарь не содержит дату с отсчетом от %1 и прибавкой %2 раб. дн.",
			Формат(ИсходнаяДата, "ДФ=dd.MM.yyyy"), КоличествоДней);
		Сообщение.Сообщить(); 
		
		Возврат Неопределено;
	
	КонецЕсли;
		
	Выборка = РезультатЗапроса.Выбрать();
	
	Если Выборка.Следующий() Тогда 
		Возврат Выборка.Дата;		
	КонецЕсли;               
	
КонецФункции

&НаКлиенте
Процедура ПолучитьНовуюДату(Команда)    
	
	НоваяДата = ПолучитьНовуюДатуНаСервере(ИсходнаяДата, КоличествоДней);
	
	Если НоваяДата <> Неопределено Тогда
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = СтрШаблон("Исходная дата: %1, прибавляется рабочих дней: %2, дата-результат: %3",
			Формат(ИсходнаяДата, "ДФ=dd.MM.yyyy"), КоличествоДней, Формат(НоваяДата, "ДФ=dd.MM.yyyy"));
		Сообщение.Сообщить();
	КонецЕсли;    
	
КонецПроцедуры
```
## Задача 4
### Условие задачи
> Напишете текст запроса (одним запросом) для получения `курса валюты` из `периодического` (периодичность `день`) регистра сведений `Курсы валют` для документов `Поступление` на дату каждого документа.
>
> Регистр сведений `Курсы валют`:
>  | Дата | Валюта | Курс |
> |------|------|-----|
> |01.01.2010|Валюта 1|1|
> |01.01.2010|Валюта 2|10|
> |03.01.2010|Валюта 2|5|
> |...|||
> 
> Документы `Поступление`:
>  |Дата|Номер|Валюта|
> |------|------|-----|
> |02.01.2010 16:30|1|Валюта 1|
> |02.01.2010 17:00|2|Валюта 2|
> |03.01.2010 20:00|3|Валюта 1|
> |...|||
>
> Запрос должен вернуть таблицу вида:
>
>  `Документ поступления` / `Валюта` / `Дата документа` / `КУрс валюты на дату документа`
### Решение
#### Исходные данные: документы `Поступление` и периодический регистр сведений `Курсы валют`
![2023-11-22_11-06](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/1071eebb-3707-4e3d-b804-41f6f64efdeb)
![2023-11-22_11-12](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/e8a93158-b99d-43f5-be73-4270115e13bf)
#### Результаты тестирования
![2023-11-22_11-10](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/4ddc9260-aad6-4ff7-953c-c470dc0a871c)
#### Текст и параметры запроса
```
ВЫБРАТЬ
	ДокПоступление.Ссылка КАК ДокументПоступления,
	ДокПоступление.Валюта КАК Валюта,
	ДокПоступление.Дата КАК ДатаДокумента,
	ЕСТЬNULL(МАКСИМУМ(КурсыВалют.Курс), ЗНАЧЕНИЕ(Справочник.Валюты.пустаяСсылка)) КАК КурсВалютыНаДатуДокумента
ИЗ
	Документ.Поступление КАК ДокПоступление
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КурсыВалют КАК КурсыВалют
		ПО ДокПоступление.Дата >= КурсыВалют.Период
			И ДокПоступление.Валюта = КурсыВалют.Валюта
ГДЕ
	ДокПоступление.Проведен = ИСТИНА

СГРУППИРОВАТЬ ПО
	ДокПоступление.Ссылка,
	ДокПоступление.Валюта,
	ДокПоступление.Дата
```
![2023-11-22_11-11](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/454c3e2a-84a8-4c41-b779-8fe470319e8a)

## Задача 5
### Условие задачи
> _Получить продажи помесячно нарастающим итогом._
> 
> Например. Контрагент “Рога и копыта” купил в январе на 100 рублей, в феврале на 50 рублей, в марте ничего не купил , в апреле на  100  рублей
> Тогда запрос должен вернуть таблицу вида
> |Контрагент |Период | Сумма нарастающим итогом с начала года |
> |-----|------|-------|
> |Рога и копыта|||
> ||Январь 2020|100|
> ||Февраль 2020|150|
> ||Март 2020|150|
> ||Апрель 2020|250|
### Решение
"Классическим" решением задачи с нарастающим итогом является внутреннее соединение таблицы сама с собой. Соединение идет по полям `Период` и `Контрагент`.
#### Исходные данные: регистр оборотов "Продажи"
Регистр оборотов `Продажи` предствлен на скриншоте [выше](https://github.com/anton-petrunov/1C-intgraty-test/tree/dev/README.md#исходные-данные-регистр-оборотов-продажи)
#### Результаты тестирования
![2023-11-21_14-13](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/3fd6fbee-a3d6-4306-a8d1-35c776bd45ad)
#### Текст и параметры запроса
```
ВЫБРАТЬ
	ПродажиОбороты.Контрагент КАК Контрагент,
	ПродажиОбороты.Период КАК Период,
	ПродажиОбороты.СуммаОборот КАК ПродажиЗаМесяц,
	СУММА(ПродажиОборотыДляИтога.СуммаОборот) КАК ПродажиНарастающимИтогом
ИЗ
	РегистрНакопления.Продажи.Обороты(, , Месяц, ) КАК ПродажиОбороты
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.Продажи.Обороты(, , Месяц, ) КАК ПродажиОборотыДляИтога
		ПО ПродажиОбороты.Период >= ПродажиОборотыДляИтога.Период
			И ПродажиОбороты.Контрагент = ПродажиОборотыДляИтога.Контрагент

СГРУППИРОВАТЬ ПО
	ПродажиОбороты.Период,
	ПродажиОбороты.СуммаОборот,
	ПродажиОбороты.Контрагент

УПОРЯДОЧИТЬ ПО
	ПродажиОбороты.Контрагент,
	ПродажиОбороты.Период
```
![2023-11-21_14-12](https://github.com/anton-petrunov/1C-intgraty-test/assets/97449490/ed6c1cea-f55c-4e46-aef4-03294c59c2fe)
